workflows:
  android-workflow:
    name: Smart Trade Tracker Android Build
    max_build_duration: 60

    environment:
      vars:
        WEB_APP_URL: "https://smarttradetracker.lovable.app"

      groups:
        - android_keystore

      android_signing:
        - keystore:
            path: android/app/keystore/smart_trade_tracker.jks
            password: $ANDROID_KEYSTORE_PASSWORD
            alias: $ANDROID_KEY_ALIAS
            key_password: $ANDROID_KEY_PASSWORD

    triggering:
      events:
        - push
      branch_patterns:
        - pattern: main
          include: true

    scripts:
      - name: Decode keystore
        script: |
          mkdir -p android/app/keystore
          echo "$ANDROID_KEYSTORE_BASE64" | base64 --decode > android/app/keystore/smart_trade_tracker.jks

      - name: Grant Gradle permission
        script: |
          chmod +x android/gradlew

      - name: Build signed APK & AAB
        script: |
          cd android
          ./gradlew assembleRelease bundleRelease

    artifacts:
      - android/app/build/outputs/**/*.apk
      - android/app/build/outputs/**/*.aab